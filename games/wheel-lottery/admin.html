<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è½¬ç›˜è®¾ç½® - ç®¡ç†åå°</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #FB7299;
            --primary-light: #FFD6E3;
            --secondary: #00A1D6;
            --bg: #f5f6fa;
            --card-bg: #ffffff;
            --text-primary: #333;
            --text-secondary: #666;
            --border: #e0e0e0;
            --success: #52c41a;
            --warning: #faad14;
            --danger: #ff4d4f;
        }

        body {
            font-family: 'Noto Sans SC', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg);
            min-height: 100vh;
            color: var(--text-primary);
        }

        /* é¡¶éƒ¨å¯¼èˆª */
        .navbar {
            background: linear-gradient(135deg, var(--primary) 0%, #E91E63 100%);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .navbar-title {
            color: #fff;
            font-size: 1.3rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .navbar-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .btn-primary {
            background: #fff;
            color: var(--primary);
        }

        .btn-primary:hover {
            background: var(--primary-light);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.2);
            color: #fff;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .btn-success {
            background: var(--success);
            color: #fff;
        }

        .btn-success:hover {
            background: #45a515;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: var(--danger);
            color: #fff;
        }

        .btn-danger:hover {
            background: #e04545;
        }

        /* ä¸»å®¹å™¨ */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px;
        }

        /* ç½‘æ ¼å¸ƒå±€ */
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        @media (max-width: 1024px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }

        /* å¡ç‰‡ */
        .card {
            background: var(--card-bg);
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            overflow: hidden;
        }

        .card-header {
            padding: 20px 25px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .card-body {
            padding: 25px;
        }

        /* è¡¨å•æ ·å¼ */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .form-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s;
            font-family: inherit;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(251, 114, 153, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        /* å¥–å“åˆ—è¡¨ */
        .prize-list {
            max-height: 600px;
            overflow-y: auto;
        }

        .prize-item {
            display: grid;
            grid-template-columns: 50px 1fr auto auto auto auto;
            gap: 15px;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid var(--border);
            transition: background 0.2s;
        }

        .prize-item:hover {
            background: #f9f9f9;
        }

        .prize-item:last-child {
            border-bottom: none;
        }

        .prize-icon-input {
            width: 50px;
            height: 50px;
            text-align: center;
            font-size: 1.8rem;
            padding: 5px;
            border: 2px dashed var(--border);
            border-radius: 10px;
            background: #f9f9f9;
        }

        .prize-icon-input:focus {
            border-style: solid;
            border-color: var(--primary);
        }

        .prize-info {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .prize-name-input {
            font-size: 1rem;
            font-weight: 600;
            padding: 8px 12px;
            border: 1px solid transparent;
            border-radius: 6px;
            background: transparent;
        }

        .prize-name-input:hover {
            background: #f0f0f0;
        }

        .prize-name-input:focus {
            outline: none;
            border-color: var(--primary);
            background: #fff;
        }

        .prize-desc-input {
            font-size: 0.85rem;
            color: var(--text-secondary);
            padding: 6px 12px;
            border: 1px solid transparent;
            border-radius: 6px;
            background: transparent;
        }

        .prize-desc-input:hover {
            background: #f0f0f0;
        }

        .prize-desc-input:focus {
            outline: none;
            border-color: var(--secondary);
            background: #fff;
        }

        .prize-rarity {
            width: 100px;
        }

        .rarity-select {
            padding: 8px 12px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 0.9rem;
            cursor: pointer;
            background: #fff;
        }

        .rarity-select:focus {
            outline: none;
            border-color: var(--primary);
        }

        .rarity-select.è¶…ç¨€æœ‰ {
            border-color: #FFD700;
            color: #B8860B;
        }

        .rarity-select.ç¨€æœ‰ {
            border-color: #A855F7;
            color: #7C3AED;
        }

        .rarity-select.æ™®é€š {
            border-color: #60A5FA;
            color: #3B82F6;
        }

        .prize-probability {
            width: 80px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .probability-input {
            width: 60px;
            padding: 8px;
            border: 2px solid var(--border);
            border-radius: 8px;
            text-align: center;
            font-weight: 600;
        }

        .probability-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .prize-actions {
            display: flex;
            gap: 5px;
        }

        .btn-icon {
            width: 36px;
            height: 36px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            font-size: 1rem;
        }

        .btn-icon.delete {
            background: #fff0f0;
            color: var(--danger);
        }

        .btn-icon.delete:hover {
            background: var(--danger);
            color: #fff;
        }

        .btn-icon.move {
            background: #f0f0f0;
            color: var(--text-secondary);
            cursor: grab;
        }

        .btn-icon.move:hover {
            background: #e0e0e0;
        }

        /* æ·»åŠ å¥–å“æŒ‰é’® */
        .add-prize-btn {
            width: 100%;
            padding: 15px;
            border: 2px dashed var(--border);
            border-radius: 12px;
            background: transparent;
            color: var(--text-secondary);
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-top: 15px;
        }

        .add-prize-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
            background: var(--primary-light);
        }

        /* ç¨€æœ‰åº¦è®¾ç½® */
        .rarity-settings {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .rarity-card {
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s;
        }

        .rarity-card:hover {
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .rarity-card.è¶…ç¨€æœ‰ {
            border-color: #FFD700;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1) 0%, rgba(255, 165, 0, 0.1) 100%);
        }

        .rarity-card.ç¨€æœ‰ {
            border-color: #A855F7;
            background: linear-gradient(135deg, rgba(168, 85, 247, 0.1) 0%, rgba(124, 58, 237, 0.1) 100%);
        }

        .rarity-card.æ™®é€š {
            border-color: #60A5FA;
            background: linear-gradient(135deg, rgba(96, 165, 250, 0.1) 0%, rgba(59, 130, 246, 0.1) 100%);
        }

        .rarity-title {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .rarity-badge {
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            color: #fff;
        }

        .color-picker-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .color-picker {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .color-picker input[type="color"] {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            padding: 0;
        }

        .color-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        /* JSON é¢„è§ˆ */
        .json-preview {
            background: #1e1e1e;
            border-radius: 12px;
            overflow: hidden;
        }

        .json-header {
            background: #333;
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .json-title {
            color: #fff;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .json-actions {
            display: flex;
            gap: 8px;
        }

        .json-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .json-btn.copy {
            background: var(--secondary);
            color: #fff;
        }

        .json-btn.copy:hover {
            background: #0090c0;
        }

        .json-btn.download {
            background: var(--success);
            color: #fff;
        }

        .json-btn.download:hover {
            background: #45a515;
        }

        .json-content {
            padding: 20px;
            max-height: 400px;
            overflow: auto;
        }

        .json-content pre {
            color: #d4d4d4;
            font-family: 'Fira Code', 'Consolas', monospace;
            font-size: 0.85rem;
            line-height: 1.5;
            margin: 0;
            white-space: pre-wrap;
        }

        /* ç»Ÿè®¡ä¿¡æ¯ */
        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--primary) 0%, #E91E63 100%);
            border-radius: 12px;
            padding: 20px;
            color: #fff;
            text-align: center;
        }

        .stat-card.blue {
            background: linear-gradient(135deg, var(--secondary) 0%, #0084B4 100%);
        }

        .stat-card.green {
            background: linear-gradient(135deg, var(--success) 0%, #389e0d 100%);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.85rem;
            opacity: 0.9;
        }

        /* å¯¼å…¥å¯¼å‡º */
        .import-export {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .file-input {
            display: none;
        }

        /* Toast æç¤º */
        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: #333;
            color: #fff;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 0.95rem;
            opacity: 0;
            transition: all 0.3s;
            z-index: 1000;
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        .toast.success {
            background: var(--success);
        }

        .toast.error {
            background: var(--danger);
        }

        /* å…¨å®½å¡ç‰‡ */
        .full-width {
            grid-column: 1 / -1;
        }

        /* æ»šåŠ¨æ¡ç¾åŒ– */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #a1a1a1;
        }
    </style>
</head>
<body>
    <!-- é¡¶éƒ¨å¯¼èˆª -->
    <nav class="navbar">
        <div class="navbar-title">
            <span>âš™ï¸</span>
            <span>è½¬ç›˜æŠ½å¥– - ç®¡ç†åå°</span>
        </div>
        <div class="navbar-actions">
            <a href="index.html" class="btn btn-secondary">
                <span>ğŸ¡</span> è¿”å›è½¬ç›˜
            </a>
            <button class="btn btn-primary" onclick="saveConfig()">
                <span>ğŸ’¾</span> ä¿å­˜é…ç½®
            </button>
        </div>
    </nav>

    <!-- ä¸»å®¹å™¨ -->
    <div class="container">
        <!-- ç»Ÿè®¡ä¿¡æ¯ -->
        <div class="stats">
            <div class="stat-card">
                <div class="stat-value" id="totalPrizes">11</div>
                <div class="stat-label">å¥–å“æ€»æ•°</div>
            </div>
            <div class="stat-card blue">
                <div class="stat-value" id="totalProbability">100%</div>
                <div class="stat-label">æ€»æ¦‚ç‡</div>
            </div>
            <div class="stat-card green">
                <div class="stat-value" id="rareProbability">22%</div>
                <div class="stat-label">ç¨€æœ‰+è¶…ç¨€æœ‰æ¦‚ç‡</div>
            </div>
        </div>

        <!-- å¯¼å…¥å¯¼å‡º -->
        <div class="import-export">
            <input type="file" id="importFile" class="file-input" accept=".json" onchange="importConfig(event)">
            <button class="btn btn-secondary" onclick="document.getElementById('importFile').click()">
                <span>ğŸ“¤</span> å¯¼å…¥é…ç½®
            </button>
            <button class="btn btn-secondary" onclick="exportConfig()">
                <span>ğŸ“¥</span> å¯¼å‡ºé…ç½®
            </button>
            <button class="btn btn-danger" onclick="resetConfig()">
                <span>ğŸ”„</span> é‡ç½®é»˜è®¤
            </button>
        </div>

        <div class="grid">
            <!-- åŸºæœ¬è®¾ç½® -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title"><span>ğŸ¯</span> åŸºæœ¬è®¾ç½®</h2>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label class="form-label">è½¬ç›˜æ ‡é¢˜</label>
                        <input type="text" class="form-input" id="settingTitle" placeholder="æ˜Ÿå–µå¹¸è¿è½¬ç›˜">
                    </div>
                    <div class="form-group">
                        <label class="form-label">å‰¯æ ‡é¢˜</label>
                        <input type="text" class="form-input" id="settingSubtitle" placeholder="è¯•è¯•ä½ çš„è¿æ°”å§~">
                    </div>
                    <div class="form-group">
                        <label class="form-label">æŠ½å¥–æŒ‰é’®æ–‡å­—</label>
                        <input type="text" class="form-input" id="settingButtonText" placeholder="å¼€å§‹æŠ½å¥–">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">è½¬åŠ¨æ—¶é•¿ (æ¯«ç§’)</label>
                            <input type="number" class="form-input" id="settingDuration" placeholder="5000">
                        </div>
                        <div class="form-group">
                            <label class="form-label">æœ€å°‘/æœ€å¤šåœˆæ•°</label>
                            <div style="display: flex; gap: 10px;">
                                <input type="number" class="form-input" id="settingMinSpins" placeholder="3" style="width: 50%;">
                                <input type="number" class="form-input" id="settingMaxSpins" placeholder="5" style="width: 50%;">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ç¨€æœ‰åº¦è®¾ç½® -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title"><span>âœ¨</span> ç¨€æœ‰åº¦è®¾ç½®</h2>
                </div>
                <div class="card-body">
                    <div class="rarity-settings" id="raritySettings">
                        <!-- åŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
            </div>

            <!-- å¥–å“åˆ—è¡¨ -->
            <div class="card full-width">
                <div class="card-header">
                    <h2 class="card-title"><span>ğŸ</span> å¥–å“åˆ—è¡¨</h2>
                    <span style="color: var(--text-secondary); font-size: 0.9rem;">
                        æç¤ºï¼šç›´æ¥ç‚¹å‡»å†…å®¹å³å¯ç¼–è¾‘
                    </span>
                </div>
                <div class="card-body">
                    <div class="prize-list" id="prizeList">
                        <!-- åŠ¨æ€ç”Ÿæˆ -->
                    </div>
                    <button class="add-prize-btn" onclick="addPrize()">
                        <span>â•</span> æ·»åŠ æ–°å¥–å“
                    </button>
                </div>
            </div>

            <!-- JSON é¢„è§ˆ -->
            <div class="card full-width">
                <div class="card-header">
                    <h2 class="card-title"><span>ğŸ“„</span> JSON é…ç½®é¢„è§ˆ</h2>
                </div>
                <div class="card-body" style="padding: 0;">
                    <div class="json-preview">
                        <div class="json-header">
                            <span class="json-title">config/prizes.json</span>
                            <div class="json-actions">
                                <button class="json-btn copy" onclick="copyJson()">ğŸ“‹ å¤åˆ¶</button>
                                <button class="json-btn download" onclick="downloadJson()">â¬‡ï¸ ä¸‹è½½</button>
                            </div>
                        </div>
                        <div class="json-content">
                            <pre id="jsonPreview"></pre>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast æç¤º -->
    <div class="toast" id="toast"></div>

    <script>
        // ==================== å…¨å±€å˜é‡ ====================
        let config = null;

        // ==================== åˆå§‹åŒ– ====================
        async function init() {
            await loadConfig();
            renderSettings();
            renderRaritySettings();
            renderPrizeList();
            updateJsonPreview();
            updateStats();
        }

        // åŠ è½½é…ç½®
        async function loadConfig() {
            try {
                const response = await fetch('config/prizes.json');
                config = await response.json();
            } catch (e) {
                console.log('ä½¿ç”¨é»˜è®¤é…ç½®');
                config = getDefaultConfig();
            }
        }

        // é»˜è®¤é…ç½®
        function getDefaultConfig() {
            return {
                settings: {
                    title: "æ˜Ÿå–µå¹¸è¿è½¬ç›˜",
                    subtitle: "è¯•è¯•ä½ çš„è¿æ°”å§~",
                    buttonText: "å¼€å§‹æŠ½å¥–",
                    spinDuration: 5000,
                    minSpins: 3,
                    maxSpins: 5
                },
                rarityConfig: {
                    "è¶…ç¨€æœ‰": {
                        color: "#FFD700",
                        bgColor: "linear-gradient(135deg, #FFD700 0%, #FFA500 50%, #FF6347 100%)",
                        glowColor: "rgba(255, 215, 0, 0.8)",
                        particleColors: ["#FFD700", "#FFA500", "#FF6347", "#FFFF00", "#FF69B4"],
                        effectType: "legendary"
                    },
                    "ç¨€æœ‰": {
                        color: "#A855F7",
                        bgColor: "linear-gradient(135deg, #A855F7 0%, #7C3AED 100%)",
                        glowColor: "rgba(168, 85, 247, 0.8)",
                        particleColors: ["#A855F7", "#7C3AED", "#C084FC", "#E879F9"],
                        effectType: "rare"
                    },
                    "æ™®é€š": {
                        color: "#60A5FA",
                        bgColor: "linear-gradient(135deg, #60A5FA 0%, #3B82F6 100%)",
                        glowColor: "rgba(96, 165, 250, 0.6)",
                        particleColors: ["#60A5FA", "#93C5FD", "#BFDBFE"],
                        effectType: "common"
                    }
                },
                prizes: [
                    { id: 1, name: "648ç°é‡‘çº¢åŒ…", rarity: "è¶…ç¨€æœ‰", probability: 1, icon: "ğŸ’°", description: "è¶…çº§å¤§å¥–ï¼648å…ƒç°é‡‘çº¢åŒ…" },
                    { id: 2, name: "æ˜Ÿå–µç»™ä½ ä¸Šèˆ°", rarity: "è¶…ç¨€æœ‰", probability: 2, icon: "ğŸš¢", description: "æ˜Ÿå–µç›´æ’­é—´èˆ°é•¿ä¸€ä¸ªæœˆ" },
                    { id: 3, name: "æ‰‹åŠ", rarity: "ç¨€æœ‰", probability: 4, icon: "ğŸ­", description: "ç²¾ç¾é™å®šæ‰‹åŠä¸€ä¸ª" },
                    { id: 4, name: "Vä½ 50", rarity: "ç¨€æœ‰", probability: 7, icon: "ğŸ’¸", description: "50å…ƒçº¢åŒ…æ‰“ç»™ä½ " },
                    { id: 5, name: "å½©ç¥¨", rarity: "ç¨€æœ‰", probability: 8, icon: "ğŸ«", description: "åˆ®åˆ®ä¹å½©ç¥¨ä¸€å¼ " },
                    { id: 6, name: "æ˜Ÿå–µå¸¸è®¾å‘¨è¾¹", rarity: "æ™®é€š", probability: 16, icon: "ğŸ", description: "æ˜Ÿå–µå®˜æ–¹å‘¨è¾¹éšæœºä¸€ä»¶" },
                    { id: 7, name: "æ˜Ÿå–µå°å¤œç¯", rarity: "æ™®é€š", probability: 16, icon: "ğŸ’¡", description: "å¯çˆ±çš„æ˜Ÿå–µé€ å‹å°å¤œç¯" },
                    { id: 8, name: "å¥¶èŒ¶", rarity: "æ™®é€š", probability: 15, icon: "ğŸ§‹", description: "å¥¶èŒ¶åˆ¸ä¸€å¼ " },
                    { id: 9, name: "å®šåˆ¶è¯­éŸ³åŒ…", rarity: "æ™®é€š", probability: 16, icon: "ğŸµ", description: "æ˜Ÿå–µä¸“å±è¯­éŸ³åŒ…" },
                    { id: 10, name: "ç‰¹äº§é¥¼é¥¼", rarity: "æ™®é€š", probability: 10, icon: "ğŸ¥®", description: "ç¾å‘³çš„ç‰¹äº§é¥¼å¹²" },
                    { id: 11, name: "è‹¹æœ", rarity: "æ™®é€š", probability: 5, icon: "ğŸ", description: "å¹³å¹³å®‰å®‰åƒè‹¹æœ" }
                ]
            };
        }

        // ==================== æ¸²æŸ“å‡½æ•° ====================
        function renderSettings() {
            document.getElementById('settingTitle').value = config.settings.title || '';
            document.getElementById('settingSubtitle').value = config.settings.subtitle || '';
            document.getElementById('settingButtonText').value = config.settings.buttonText || '';
            document.getElementById('settingDuration').value = config.settings.spinDuration || 5000;
            document.getElementById('settingMinSpins').value = config.settings.minSpins || 3;
            document.getElementById('settingMaxSpins').value = config.settings.maxSpins || 5;
        }

        function renderRaritySettings() {
            const container = document.getElementById('raritySettings');
            const rarities = ['è¶…ç¨€æœ‰', 'ç¨€æœ‰', 'æ™®é€š'];
            const badges = {
                'è¶…ç¨€æœ‰': 'ğŸŒŸ ä¼ è¯´çº§',
                'ç¨€æœ‰': 'ğŸ’ ç¨€æœ‰çº§',
                'æ™®é€š': 'ğŸ“¦ æ™®é€šçº§'
            };

            container.innerHTML = rarities.map(rarity => {
                const rc = config.rarityConfig[rarity];
                return `
                    <div class="rarity-card ${rarity}">
                        <div class="rarity-title">
                            <span class="rarity-badge" style="background: ${rc.bgColor}">${badges[rarity]}</span>
                            <span>${rarity}</span>
                        </div>
                        <div class="color-picker-group">
                            <div class="color-picker">
                                <input type="color" value="${rc.color}" onchange="updateRarityColor('${rarity}', 'color', this.value)">
                                <span class="color-label">ä¸»è‰²</span>
                            </div>
                            <div class="color-picker">
                                <input type="color" value="${rc.glowColor.replace(/rgba?\([^)]+\)/, rc.color)}" onchange="updateRarityColor('${rarity}', 'glow', this.value)">
                                <span class="color-label">å‘å…‰è‰²</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderPrizeList() {
            const container = document.getElementById('prizeList');
            
            container.innerHTML = config.prizes.map((prize, index) => `
                <div class="prize-item" data-id="${prize.id}">
                    <input type="text" class="prize-icon-input" value="${prize.icon}" 
                           onchange="updatePrize(${index}, 'icon', this.value)" maxlength="2">
                    <div class="prize-info">
                        <input type="text" class="prize-name-input" value="${prize.name}" 
                               onchange="updatePrize(${index}, 'name', this.value)" placeholder="å¥–å“åç§°">
                        <input type="text" class="prize-desc-input" value="${prize.description}" 
                               onchange="updatePrize(${index}, 'description', this.value)" placeholder="å¥–å“æè¿°">
                    </div>
                    <div class="prize-rarity">
                        <select class="rarity-select ${prize.rarity}" onchange="updatePrize(${index}, 'rarity', this.value); this.className='rarity-select '+this.value">
                            <option value="è¶…ç¨€æœ‰" ${prize.rarity === 'è¶…ç¨€æœ‰' ? 'selected' : ''}>è¶…ç¨€æœ‰</option>
                            <option value="ç¨€æœ‰" ${prize.rarity === 'ç¨€æœ‰' ? 'selected' : ''}>ç¨€æœ‰</option>
                            <option value="æ™®é€š" ${prize.rarity === 'æ™®é€š' ? 'selected' : ''}>æ™®é€š</option>
                        </select>
                    </div>
                    <div class="prize-probability">
                        <input type="number" class="probability-input" value="${prize.probability}" 
                               onchange="updatePrize(${index}, 'probability', parseFloat(this.value))" step="0.1" min="0" max="100">
                        <span>%</span>
                    </div>
                    <div class="prize-actions">
                        <button class="btn-icon delete" onclick="deletePrize(${index})" title="åˆ é™¤">ğŸ—‘ï¸</button>
                    </div>
                </div>
            `).join('');
        }

        // ==================== æ›´æ–°å‡½æ•° ====================
        function updatePrize(index, field, value) {
            config.prizes[index][field] = value;
            updateJsonPreview();
            updateStats();
        }

        function updateRarityColor(rarity, type, value) {
            if (type === 'color') {
                config.rarityConfig[rarity].color = value;
            } else if (type === 'glow') {
                config.rarityConfig[rarity].glowColor = hexToRgba(value, 0.8);
            }
            updateJsonPreview();
        }

        function hexToRgba(hex, alpha) {
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            return `rgba(${r}, ${g}, ${b}, ${alpha})`;
        }

        function addPrize() {
            const newId = Math.max(...config.prizes.map(p => p.id), 0) + 1;
            config.prizes.push({
                id: newId,
                name: "æ–°å¥–å“",
                rarity: "æ™®é€š",
                probability: 5,
                icon: "ğŸ",
                description: "æ–°å¥–å“æè¿°"
            });
            renderPrizeList();
            updateJsonPreview();
            updateStats();
            showToast('å·²æ·»åŠ æ–°å¥–å“', 'success');
        }

        function deletePrize(index) {
            if (config.prizes.length <= 2) {
                showToast('è‡³å°‘éœ€è¦ä¿ç•™2ä¸ªå¥–å“', 'error');
                return;
            }
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå¥–å“å—ï¼Ÿ')) {
                config.prizes.splice(index, 1);
                renderPrizeList();
                updateJsonPreview();
                updateStats();
                showToast('å·²åˆ é™¤å¥–å“', 'success');
            }
        }

        function updateStats() {
            const total = config.prizes.length;
            const totalProb = config.prizes.reduce((sum, p) => sum + p.probability, 0);
            const rareProb = config.prizes
                .filter(p => p.rarity === 'è¶…ç¨€æœ‰' || p.rarity === 'ç¨€æœ‰')
                .reduce((sum, p) => sum + p.probability, 0);

            document.getElementById('totalPrizes').textContent = total;
            document.getElementById('totalProbability').textContent = totalProb.toFixed(1) + '%';
            document.getElementById('rareProbability').textContent = rareProb.toFixed(1) + '%';

            // å¦‚æœæ€»æ¦‚ç‡ä¸æ˜¯100%ï¼Œæ˜¾ç¤ºè­¦å‘Š
            if (Math.abs(totalProb - 100) > 0.1) {
                document.getElementById('totalProbability').style.color = '#ff4d4f';
            } else {
                document.getElementById('totalProbability').style.color = '';
            }
        }

        function updateJsonPreview() {
            collectSettingsFromForm();
            const json = JSON.stringify(config, null, 2);
            document.getElementById('jsonPreview').textContent = json;
        }

        function collectSettingsFromForm() {
            config.settings.title = document.getElementById('settingTitle').value;
            config.settings.subtitle = document.getElementById('settingSubtitle').value;
            config.settings.buttonText = document.getElementById('settingButtonText').value;
            config.settings.spinDuration = parseInt(document.getElementById('settingDuration').value) || 5000;
            config.settings.minSpins = parseInt(document.getElementById('settingMinSpins').value) || 3;
            config.settings.maxSpins = parseInt(document.getElementById('settingMaxSpins').value) || 5;
        }

        // ==================== ä¿å­˜å’Œå¯¼å‡º ====================
        function saveConfig() {
            collectSettingsFromForm();
            
            // ç”±äºæ˜¯é™æ€é¡µé¢ï¼Œå®é™…ä¿å­˜éœ€è¦ä¸‹è½½ JSON
            const json = JSON.stringify(config, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = 'prizes.json';
            a.click();
            
            URL.revokeObjectURL(url);
            showToast('é…ç½®å·²ä¸‹è½½ï¼Œè¯·å°† prizes.json æ”¾å…¥ config æ–‡ä»¶å¤¹', 'success');
        }

        function exportConfig() {
            collectSettingsFromForm();
            const json = JSON.stringify(config, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = 'prizes-backup-' + new Date().toISOString().slice(0, 10) + '.json';
            a.click();
            
            URL.revokeObjectURL(url);
            showToast('é…ç½®å·²å¯¼å‡º', 'success');
        }

        function importConfig(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const imported = JSON.parse(e.target.result);
                    
                    // éªŒè¯é…ç½®æ ¼å¼
                    if (!imported.settings || !imported.prizes || !imported.rarityConfig) {
                        throw new Error('é…ç½®æ ¼å¼ä¸æ­£ç¡®');
                    }

                    config = imported;
                    renderSettings();
                    renderRaritySettings();
                    renderPrizeList();
                    updateJsonPreview();
                    updateStats();
                    showToast('é…ç½®å¯¼å…¥æˆåŠŸ', 'success');
                } catch (err) {
                    showToast('å¯¼å…¥å¤±è´¥ï¼š' + err.message, 'error');
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        function resetConfig() {
            if (confirm('ç¡®å®šè¦é‡ç½®ä¸ºé»˜è®¤é…ç½®å—ï¼Ÿæ‰€æœ‰ä¿®æ”¹å°†ä¸¢å¤±ï¼')) {
                config = getDefaultConfig();
                renderSettings();
                renderRaritySettings();
                renderPrizeList();
                updateJsonPreview();
                updateStats();
                showToast('å·²é‡ç½®ä¸ºé»˜è®¤é…ç½®', 'success');
            }
        }

        function copyJson() {
            const json = document.getElementById('jsonPreview').textContent;
            navigator.clipboard.writeText(json).then(() => {
                showToast('JSON å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
            }).catch(() => {
                showToast('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶', 'error');
            });
        }

        function downloadJson() {
            collectSettingsFromForm();
            const json = JSON.stringify(config, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = 'prizes.json';
            a.click();
            
            URL.revokeObjectURL(url);
        }

        // ==================== å·¥å…·å‡½æ•° ====================
        function showToast(message, type = '') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'toast ' + type;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // ç›‘å¬è¾“å…¥å˜åŒ–
        document.querySelectorAll('#settingTitle, #settingSubtitle, #settingButtonText, #settingDuration, #settingMinSpins, #settingMaxSpins')
            .forEach(input => {
                input.addEventListener('input', updateJsonPreview);
            });

        // åˆå§‹åŒ–
        init();
    </script>
</body>
</html>
